# 消息可靠性功能 - 快速测试指南

## 🚀 快速开始（5分钟测试）

### 步骤 1: 启动服务

打开两个终端窗口：

**终端 1 - 启动后端**:
```bash
cd /home/lijiajun/Cursor/03_Web_Interaction/distributed-pbft/backend
python main.py
```

**终端 2 - 启动前端**:
```bash
cd /home/lijiajun/Cursor/03_Web_Interaction/distributed-pbft
npm run dev
```

### 步骤 2: 创建会话

1. 打开浏览器，访问 `http://localhost:3000`
2. 配置参数：
   - 节点总数: **5**
   - 机器人节点数: **2**（这样有3个人类节点位置）
   - 拓扑结构: **全连接**
   - 提议值: **0**
   - 其他保持默认
3. 点击 **"创建会话"**

### 步骤 3: 加入节点并测试

1. **打开3个新的浏览器窗口或标签页**（或使用多个设备）

2. **在每个窗口中**:
   - 扫描二维码或点击 "节点2"、"节点3"、"节点4" 链接
   - 等待新一轮共识开始（约10秒）

3. **在其中一个节点页面（例如节点2）**:
   
   a. 选择 **"拜占庭攻击"** 模式
   
   b. 向下滚动，找到 **"📡 消息可靠性控制"**
   
   c. 点击 **"显示可靠性矩阵"**
   
   d. 测试不同的可靠性设置：

### 🧪 测试场景

#### 场景 A: 完全阻断某个节点

1. 在可靠性矩阵中，找到 "→ 节点3"
2. 将滑块拖到 **0%**
3. 观察右侧显示 "0%"
4. 点击 **"发送错误信息"** 按钮
5. **检查后端日志**，应该看到类似：
   ```
   节点 2 的准备消息已发送给节点 0
   节点 2 的准备消息已发送给节点 1
   节点 2 到节点 3 的准备消息被丢弃（可靠性设置）  ← 这条！
   节点 2 的准备消息已发送给节点 4
   ```

#### 场景 B: 模拟不稳定网络

1. 点击快速设置的 **"50%"** 按钮
2. 所有节点的可靠性都设置为 50%
3. 多次点击 **"发送错误信息"**
4. **观察**: 大约一半的消息会被丢弃

#### 场景 C: 恢复正常通信

1. 点击快速设置的 **"100%"** 按钮
2. 所有消息恢复正常发送
3. 点击 **"发送错误信息"**
4. 所有目标节点都应该收到消息

### 步骤 4: 观察共识结果

1. 在任意节点页面，点击 **"显示共识结果"**
2. 观察可靠性设置对共识的影响：
   - 100% 可靠性：共识应该正常进行
   - 0% 阻断多个节点：可能导致共识失败
   - 50% 不稳定：共识可能超时或失败

## 📊 后端日志示例

**正常发送（100% 可靠性）**:
```
节点 2 的准备消息已发送给节点 0
节点 2 的准备消息已发送给节点 1
节点 2 的准备消息已发送给节点 3
节点 2 的准备消息已发送给节点 4
```

**部分丢弃（混合可靠性）**:
```
节点 2 的准备消息已发送给节点 0
节点 2 到节点 1 的准备消息被丢弃（可靠性设置）
节点 2 的准备消息已发送给节点 3
节点 2 到节点 4 的准备消息被丢弃（可靠性设置）
```

**完全阻断（0% 可靠性）**:
```
节点 2 到节点 0 的准备消息被丢弃（可靠性设置）
节点 2 到节点 1 的准备消息被丢弃（可靠性设置）
节点 2 到节点 3 的准备消息被丢弃（可靠性设置）
节点 2 到节点 4 的准备消息被丢弃（可靠性设置）
```

## 🎯 快速验证清单

- [ ] 后端和前端服务都正常启动
- [ ] 成功创建会话
- [ ] 至少加入2个人类节点
- [ ] 能够显示可靠性矩阵
- [ ] 滑块可以调整，值实时更新
- [ ] 快速设置按钮工作正常
- [ ] 后端日志显示消息发送/丢弃信息
- [ ] 不同可靠性设置产生不同的结果

## 🔍 常见问题排查

### 问题 1: 看不到"消息可靠性控制"
**原因**: 没有选择"拜占庭攻击"模式  
**解决**: 在节点页面顶部选择"拜占庭攻击"按钮

### 问题 2: 后端没有日志输出
**原因**: 没有实际发送消息  
**解决**: 确保点击了"发送错误信息"按钮

### 问题 3: 所有消息都被发送，即使设置了0%
**原因**: 可能是其他节点发送的消息  
**解决**: 
- 检查后端日志中的"节点X"编号，确认是你控制的节点
- 确保调整的是正确节点的可靠性

### 问题 4: 无法调整滑块
**原因**: 可能处于等待下一轮共识状态  
**解决**: 等待新一轮共识开始（约10秒）

## 📝 测试记录模板

使用以下模板记录你的测试结果：

```
测试时间: ___________
测试人员: ___________

测试配置:
- 节点总数: ___
- 机器人节点数: ___
- 人类节点数: ___
- 拓扑结构: ___________

测试场景 1: 完全阻断某节点
- 设置节点X到节点Y的可靠性: 0%
- 预期: 节点Y收不到节点X的消息
- 实际结果: ☐ 通过 ☐ 失败
- 备注: ___________

测试场景 2: 50%不稳定网络
- 设置所有连接为: 50%
- 发送消息次数: ___
- 成功发送次数: ___
- 丢弃次数: ___
- 实际丢包率: ___%
- 预期结果: 约50%
- 实际结果: ☐ 通过 ☐ 失败

测试场景 3: 恢复正常
- 设置所有连接为: 100%
- 预期: 所有消息正常发送
- 实际结果: ☐ 通过 ☐ 失败

总体评价:
- 功能完整性: ☐ 优秀 ☐ 良好 ☐ 需改进
- 用户体验: ☐ 优秀 ☐ 良好 ☐ 需改进
- 性能表现: ☐ 优秀 ☐ 良好 ☐ 需改进

发现的问题:
1. ___________
2. ___________

建议改进:
1. ___________
2. ___________
```

## 🎓 进阶测试

如果你想深入测试，可以尝试：

### 测试 1: 网络分区
- 将节点2到节点0、1的可靠性设为0%
- 将节点2到节点3、4的可靠性设为100%
- 观察是否形成网络分区

### 测试 2: 级联故障
- 多个节点同时设置低可靠性
- 观察共识是否失败

### 测试 3: 动态调整
- 在共识进行中改变可靠性设置
- 观察新设置何时生效

### 测试 4: 压力测试
- 创建大量节点（10-15个）
- 设置复杂的可靠性矩阵
- 观察系统性能

## 📚 更多资源

- 详细使用指南: `MESSAGE_RELIABILITY_GUIDE.md`
- 技术实现说明: `消息可靠性功能总结.md`
- 自动化测试: `python test_reliability.py`

## ✅ 测试完成

如果以上所有测试场景都通过，说明消息可靠性控制功能已经成功实现并正常工作！

祝测试顺利！ 🎉






